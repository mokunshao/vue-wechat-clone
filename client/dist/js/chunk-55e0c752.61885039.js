(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-55e0c752"],{"00b3":function(t,e,s){"use strict";var a=s("4427"),n=s.n(a);n.a},"0418":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("header",{staticClass:"header"},[t.hasLeft?s("div",{staticClass:"headerButton"},[s("font-awesome-icon",{attrs:{icon:"chevron-left"}}),s("button",{on:{click:t.goBack}},[t._v("返回")])],1):t._e(),s("div",{staticClass:"headerTitle"},[t._v(t._s(t.title))]),t.btnIcon?s("div",{staticClass:"headerButton"},[s("button",{on:{click:function(e){return t.$emit("clickRight")}}},[s("font-awesome-icon",{attrs:{icon:t.btnIcon}})],1)]):t._e()])},n=[],i={name:"Header",props:{title:String,hasLeft:{type:Boolean,default:!1},btnIcon:String,goBackTo:String},methods:{goBack:function(){this.goBackTo?this.$router.push(this.goBackTo):this.$router.go(-1)}}},r=i,o=(s("00b3"),s("2877")),c=Object(o["a"])(r,a,n,!1,null,"26b70ee1",null);e["a"]=c.exports},"1fb8":function(t,e,s){"use strict";var a=s("9ebd"),n=s.n(a);n.a},"293a":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.targetUser?s("div",{staticClass:"chat"},[s("Header",{attrs:{title:t.targetUser.username,hasLeft:!0,btnIcon:"ellipsis-h"}}),s("div",{staticClass:"container"},t._l(t.messageList,function(e,a){return s("div",{key:a,staticClass:"content_wrap"},["other"===e.source?s("div",{staticClass:"left_msg"},[s("img",{attrs:{src:t.targetUser.avatar,alt:"img"}}),s("span",[t._v(t._s(e.msg))])]):t._e(),"self"===e.source?s("div",{staticClass:"right_msg"},[s("span",[t._v(t._s(e.msg))]),s("img",{attrs:{src:t.user.avatar,alt:"img"}})]):t._e()])}),0),s("div",{staticClass:"footerWrap"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.messageValue,expression:"messageValue"}],attrs:{type:"text"},domProps:{value:t.messageValue},on:{input:function(e){e.target.composing||(t.messageValue=e.target.value)}}}),s("button",{attrs:{disabled:!t.messageValue},on:{click:t.sendMessage}},[t._v("发送")])])],1):t._e()},n=[],i=s("0418"),r=s("6c23"),o={name:"Chat",components:{Header:i["a"]},computed:{user:function(){return this.$store.getters.user}},data:function(){return{targetUser:null,messageValue:"",messageList:[]}},methods:{saveMessage:function(){var t=this,e={target:{avatar:this.targetUser.avatar,username:this.targetUser.username,_id:this.targetUser._id},count:0,message:this.messageList,user_id:this.user.id};this.$axios.post("/api/chat/addmsg",e).then(function(){t.messageValue=""})},sendMessage:function(){var t={target:this.targetUser._id,current:this.user.id,msg:this.messageValue};r["a"].send(t),this.messageList.push({msg:this.messageValue,source:"self"}),this.saveMessage(),this.messageValue=""},getMessage:function(){var t=this;this.$axios("/api/chat/msg/".concat(this.user.id)).then(function(e){var s=e.data.filter(function(e){return e.target._id===t.targetUser._id});s.length>0&&(t.messageList=s[0].message)})}},beforeRouteEnter:function(t,e,s){s(function(e){e.targetUser=t.params.user,e.getMessage()})},mounted:function(){var t=this;r["a"].init({user:this.user},function(e){t.messageList.push({msg:e.msg,source:"other"}),t.saveMessage()},function(t){return console.log(t)})}},c=o,u=(s("1fb8"),s("2877")),g=Object(u["a"])(c,a,n,!1,null,"0e033a5c",null);e["default"]=g.exports},4427:function(t,e,s){},"6c23":function(t,e,s){"use strict";e["a"]={ws:null,init:function(t,e,s){var a=this;this.ws||(this.ws=new WebSocket("ws://localhost:3000/".concat(t.user.id))),this.ws.onmessage=function(t){var s=JSON.parse(t.data);e&&e(s)},this.ws.onerror=function(t){s&&s(t)},this.ws.onclose=function(){a.ws=null}},send:function(t){this.ws.send(JSON.stringify(t))}}},"9ebd":function(t,e,s){}}]);
//# sourceMappingURL=chunk-55e0c752.61885039.js.map